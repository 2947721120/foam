<html>
 <head>
  <link rel="stylesheet" type="text/css" href="..//core/foam.css" />
  <script language="javascript" src="../core/bootFOAM.js"></script>
  <script language="javascript" src="dragon.js"></script>
  <title>FOAM DOM Objects</title>
  <style>
    h3 {color: #444;}
    .code {width:900px; white-space: pre; border: 1px solid; padding: 5px; font-family: monospace;}
    .output {width:900px; white-space: pre; border: 1px solid; padding: 5px; color: blue;}
    .error {border: 2px solid red;}
    .description { margin-left: 20px; font-size: 115%; }
  </style>
 </head>

 <body>

<script language="javascript">
FOAModel({
  name: 'DemoView',
  extendsModel: 'DetailView',
  templates: [ { name: 'toHTML' } ]
});
</script>

<!--
<foam model="Model" name="DemoView" extendsModel="DetailView">
  <templates>
     <template name="toHTML"><code>
       <h2>$$name{mode:'read-only'}<h2>
       <div class="code">$$code{mode:'read-only'}</div>
       <div class="results">$$results</div>
     </code></template>
  </templates>
</foam>
-->

<foam model="UnitTest" onInit="this.test()" view="DemoView">
  <name>Context Examples</name>
  <code>
    X.a = 42;
    log(X.a);
    var Y = X.sub({a:1,b:2}, 'Y');
    log(Y);
    log(Y.a);
    Mouse.create();
    var m1 = Mouse.create();
    var m2 = Y.Mouse.create();
    log('m2.X ', m2.X);
    log('m1.X ', m1.X);
    log(m2.X.a);
    var m3 = m2.X.Mouse.create();
    log(m3.X);
    log(m3.X.a);
  </code>
  <tests>
    <foam model="UnitTest" name="SubTest1"><code>
    log('sub test 1, part 1');
    log('sub test 1, part 2');
    </code></foam>
    <foam model="UnitTest" name="SubTest2"><code>
    log('sub test 2');
    </code></foam>
  </tests>
</foam>

<foam model="UnitTest" onInit="this.test()" view="DemoView">
  <name>A UnitTest embedded in DOM</name>
  <code>
    log('Here I am.');
    log('And here.');
  </code>
  <tests>
    <foam model="UnitTest" name="SubTest1"><code>
    log('sub test 1, part 1');
    log('sub test 1, part 2');
    </code></foam>
    <foam model="UnitTest" name="SubTest2"><code>
    log('sub test 2');
    </code></foam>
  </tests>
</foam>

<foam model="UnitTest" onInit="this.test()" view="DemoView">
  <name>A failed Test</name>
  <code>
    fail("Something's wrong.");
  </code>
</foam>

<foam model="UnitTest" onInit="this.test()" view="DemoView">
  <name>DAO Tests</name>
  <description>Define the Model (like a schema) and create a DAO.</description>
  <code>
    Person = FOAM({
      model_: 'Model',
      name: 'Person',
      properties: [
        { name: 'id' },
        { name: 'name' },
        { name: 'sex', defaultValue: 'M' },
        { model_: 'IntegerProperty', name: 'age' }
      ]
    });

    dao = MDAO.create({model: Person})
      .addIndex(Person.NAME)
      .addIndex(Person.SEX, Person.AGE);

    log(dao);
</code>
  <tests>
    <foam model="UnitTest" name="SubTest1">
      <description>Add some sample data and select ot a 'sink'.</description>
      <code>
        dao.put(Person.create({id:'1', name:'John',  age:21}));
        dao.put(Person.create({id:'2', name:'Dave',  age:20}));
        dao.put(Person.create({id:'3', name:'Steve', age:19}));
        dao.put(Person.create({id:'4', name:'Andy',  age:18}));

        dao.select({put: function(p) { log('person: ', p.name); }});
    </code></foam>
    <foam model="UnitTest" name="SubTest2">
      <description>Select directly to an Array.</description>
      <code>
        var a = [];
        dao.select(a);
        jlog(a);
    </code></foam>
  </tests>
</foam>

<foam model="UnitTest" onInit="this.test()" view="DemoView">
  <name>aFunc Tests</name>
  <description>Test FOAM's Asynchronous-Functions (aFunc's).</description>
  <async>true</async>
  <code>
    console.log('console.log');
    log('here i am');
    ret();
  </code>
  <tests>
    <foam model="UnitTest" name="anop">
      <async>true</async>
      <code>log('anop'); aseq(alog('before'), anop, alog('after'))(ret);</code>
    </foam>
    <foam model="UnitTest" name="abind">
      <async>true</async>
      <code>
          var boo = function() { log('boo'); }
          boo();
          boo.abind(null)(ret);
      </code>
    </foam>
    <foam model="UnitTest" name="alog">
      <async>true</async>
      <code>log('alog'); alog('a message')(ret);</code>
    </foam>
    <foam model="UnitTest" name="asleep">
      <async>true</async>
      <code>aseq(asleep(1000), alog('a message'))(ret);</code>
    </foam>
    <foam model="UnitTest" name="ayield">
      <async>true</async>
      <code>aseq(ayield(), alog('a message'))(ret);</code>
    </foam>
  </tests>
</foam>

 </body>
</html>
