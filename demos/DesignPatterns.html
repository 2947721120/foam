<html>
 <head>
  <style type="text/css">
    .bar {
       color: white;
       margin-left:8px;
       font-family: Arial, sans-serif;
       font-size: 14px;
       font-style: normal;
       font-variant: normal;
       font-weight: normal;
    } 
  </style>

  <link rel="stylesheet" type="text/css" href="foam.css" />
  <script>var FOAM_BOOT_DIR="../";</script>
  <script language="javascript" src="../bootFOAM.js"></script> 
  <script language="javascript" src="../UML.js"></script> 
  <title>FOAM Test</title>
 </head>

 <body>
  <script language="javascript">
    var canvas = Canvas.create({width: 2000, height: 2000, background:'white'});
    canvas.write(document);
    var ctx = canvas.$.getContext('2d');
    var mouse   = Mouse.create();
    mouse.connect(canvas.$);
    Events.dynamic(function() { console.log(mouse.x, mouse.y); });
  
    var WIDTH  = 80;
    var HEIGHT = 105;
    var XS     = 115;
    var YS     = 180;
    
    var ms = {};
    function line() {
      var a = arguments;
      ctx.beginPath();
      ctx.moveTo(a[0], a[1]);
      for ( var i = 2; i < a.length ; i += 2 ) {
        ctx.lineTo(a[i], a[i+1]);
      }
      ctx.stroke();
    }
    function label(x, y, txt) {
      ctx.fillText(txt, x, y);
    }
    function solidArrow(x, y) {
          ctx.beginPath();
          ctx.moveTo(x, y);  
          ctx.lineTo(x+8, y+8);  
          ctx.lineTo(x-8, y+8);  
          ctx.lineTo(x, y);  
          ctx.fill();
    }
    function arrow(x, y, d) {
          ctx.beginPath();
          ctx.moveTo(x, y);
          ctx.lineTo(x-8*d, y-8);
          ctx.lineTo(x, y);
          ctx.lineTo(x-8*d, y+8);
          ctx.stroke();
    }
    function extend(x1, y1, x2, y2) {
          ctx.beginPath();
          ctx.moveTo(x1*XS+WIDTH/2, y1*YS);
          ctx.lineTo(x1*XS+WIDTH/2, y1*YS-20);  
          ctx.lineTo(x2*XS+WIDTH/2, y1*YS-20);  
          ctx.lineTo(x2*XS+WIDTH/2, y2*YS+HEIGHT);  
          ctx.stroke();

          solidArrow(x2*XS+WIDTH/2, y2*YS+HEIGHT);
    }
    function uses(c1, c2, opt_s1, opt_s2) {
          var x1 = ms[c1].x;
          var y1 = ms[c1].y;
          var x2 = ms[c2].x;
          var y2 = ms[c2].y;

          var s1 = opt_s1 != undefined ? opt_s1 : x2 > x1 ? 1 : 0;  
          var s2 = opt_s2 != undefined ? opt_s2 : x2 > x1 ? 0 : 1; 
          var d = s2 ? -1 : 1;
          var d2 = s1 ? 1 : -1;

          ctx.beginPath();
          ctx.moveTo(x1*XS+s1*WIDTH, y1*YS+HEIGHT/2);
          ctx.lineTo(x1*XS+s1*WIDTH+20*d2, y1*YS+HEIGHT/2);
          ctx.lineTo(x1*XS+s1*WIDTH+20*d2, y2*YS+HEIGHT/2);
          ctx.lineTo(x2*XS+s2*WIDTH, y2*YS+HEIGHT/2);
          ctx.stroke();

          arrow(x2*XS+s2*WIDTH, y2*YS+HEIGHT/2, d);
    }
    function model(name, color, x, y, opt_extends, opt_methods) {
      if ( x >= 5 ) x -= 0.5;
      ms[name] = {x:x, y:y};
      var m = {name: name, properties:[{name:''},{name:''},{name:''}]};
      if ( opt_methods ) {
        var meths = opt_methods.split('/');
        for ( var i = 0 ; i < meths.length ; i++ ) m.properties[i].name = meths[i];
      }
      drawUML(ctx, x*XS, y*YS, m, WIDTH, color);
      if ( opt_extends ) {
        var parents = opt_extends.split('/');
        for ( var i = 0 ; i < parents.length ; i++ ) {
          var p = ms[parents[i]];
          extend(x, y, p.x, p.y);
        }
      }
    }

//    var ic = '#f3fff3';
//    var oc = '#e8e8e8';
//    var cc = '#f3f3ff';

    var ic = '#f3fff3';
    var oc = '#e8e8e8';
    var cc = '#fafaff';
                   

    model('Client',      oc, 2.5, 0, null, 'getA()/setA()');  
    model('Interface',   ic, 5, 0);
    model('Mediator',    cc, 2.5, 1, 'Client');
    model('MVC',         cc, 2.5, 5);
    model('Strategy',    '#fdd',   5, 1, 'Interface');
    model('Strategy 2',  cc,   6, 1, 'Interface');
    model('Strategy 3',  cc,   7, 1, 'Interface');
    model('Strategy n',  cc,   9, 1, 'Interface');
    model('Adapter',     cc, 0.5, 3, 'Strategy');
    model('Bridge',      cc, 1.5, 3, 'Strategy');
    model('Observable',  cc, 2.5, 3, 'Strategy', 'addListener()');
    model('Model',       cc, 2, 4, 'Observable');
    model('View',        cc, 3, 4, 'Observable');
    model('Observer',    cc, 3.5, 3, 'Strategy', 'notify()');
    model('Proxy',       cc, 5, 3, 'Strategy', 'getA()/setA()');
    model('Composite',   cc, 6, 3, 'Strategy', 'children()');
    model('Command',     cc, 7, 3, 'Strategy', 'do()');
    model('Factory',     cc, 8, 3, 'Strategy', 'create()');
    model('NullObject',  cc, 9, 3, 'Strategy', 'f() {/   NOOP/}');
    model('Flyweight',   cc, 10, 3, 'Strategy', 'f(obj,...)');
    model('Iterator',    cc, 11, 3, 'Strategy', 'hasNext()/next()');
    model('State',       cc, 12, 3, 'Strategy', 'nextState()');
    model('Other',       oc, 0.5, 4);
    model('Decorator',   cc, 5, 4, 'Proxy');
    model('Interpreter', cc, 6.5, 4, 'Composite/Command');
    model('A',           oc, 10, 4);
    model('Chain Of R.', cc, 5, 5, 'Decorator');
    model('ByClass',     cc, 6, 5, 'Factory');
    model('Builder',     cc, 7, 5, 'Factory', 'configA()/configB()/...');
    model('Trader',      cc, 8, 5, 'Factory');
    model('Singleton',   cc, 9, 5, 'Factory', 'instance()');
    model('Prototype',  cc, 10, 5, 'Factory');

    model('Interface 2',  ic, 0.5, 0.2);
    model('Interface 3',  ic, 0.5, 1);
    model('Interface n',  ic, 0.5, 1.8);

    label(890, 240, '...');
    label(90, 305, '...');
    label(420, 40, 'uses');
    label(1005, 760, 'creates');
    label(1205, 870, 'clones');
    label(610, 50, '*');
    label(393, 583, '*');
    label(1300, 1050, 'Kevin Greer  2013');

    uses('Observable', 'Observer');
    uses('Client', 'Interface');
    ms.Mediator.y -= 0.1; uses('Mediator', 'Interface 2');
    ms.Mediator.y += 0.1; uses('Mediator', 'Interface 3');
    ms.Mediator.y += 0.1; uses('Mediator', 'Interface n');
    uses('Factory', 'A');
    uses('Bridge', 'Other');
    uses('Adapter', 'Other', 0, 0);
    uses('Proxy', 'Interface', 0, 0);
    uses('Composite', 'Interface');
    uses('Prototype', 'A', 1, 1);
//    uses('MVC', 'Model', 0, 0);
//    uses('MVC', 'View', 1, 1);

    line(325, 900,  325, 880,  5, 880,  5, 470,  325, 470,  325, 286); solidArrow(325, 286);
    line(367, 950,  445, 950,   445, 770,  425, 770); arrow(425, 770, -1);
    line(287, 950,  210, 950,   210, 770,  230, 770); arrow(230, 770, 1);
  </script>

 </body>
</html>
