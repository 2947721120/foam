<html>
 <head>
  <link rel="stylesheet" type="text/css" href="foam.css" />
  <script language="javascript" src="bootFOAM.js"></script> 
  <script language="javascript" src="CIssueSchema.js"></script>
  <script language="javascript" src="cissue_data.js"></script> 
  <title>Chrome Issues</title>
 </head>

 <body>
<div style="height:40px;background:whitesmoke;border-width: 0 0 1px;border: 0 solid #e5e5e5;">
<font size=+3 face="catull" style="text-shadow:rgba(64,64,64,0.3) 3px 3px 4px;">
Chrome Issues
</font></font>
</div>
<br/>

  <script language="javascript">
    // var CIssueDAO = StorageDAO.create({model: CIssue});
    var CIssueDAO = issues;

    var stack = StackView.create();
    stack.write(document);

    FOAM.browse(CIssue);

var COL = {
  create: function() { return { __proto__: this, values: [] }; },
  put: function(v) { this.values.push(v); },
  toHTML: function() { return this.values.join('<br/>'); },
  clone: function() { return this.create(); }
};

var ItemCount = Model.create({
   extendsModel: 'CountExpr',
   methods: {
     toString: function() {
       return '<span class="idcount">' + this.count + (this.count == 1 ? ' item' : ' items') + '</span>';
     }
   }
});

var idFormatter = {
  f: function(i) { return '<span class=idlist>' + i.id + '</span>'; }
};

var altView = AlternateView.create({
  views: [
    ViewChoice.create({
      label: 'Table',
      view: function() {
	return TableView2.create({
          model: CIssue,
          dao: issues
        });
      }
    }),
    ViewChoice.create({
      label: 'Grid',
      view: function() {
	var g = GridView.create({
          model: CIssue,
          dao: issues,
          accChoices: [
            [ MAP(CIssueTileView.create(), COL.create()), "Tiles"  ],
            [ MAP(idFormatter, COL.create()),             "IDs"    ],
            [ ItemCount.create(),                         "Counts" ]
          ],
          grid: GridByExpr.create()
        });

        // Pre-set default values.  TODO: persist settings
	g.row.value.set(CIssue.OWNER);
	g.col.value.set(CIssue.STATUS);
	g.acc.value.set(g.accChoices[0][0]);
		    
        return g;
      }
    })
  ]
});

altView.write(document);
  </script>
 </body>
</html>
