<html>
 <head>
  <meta name="viewport" content="width=device-width, user-scalable=no">
  <link rel="stylesheet" href="../../core/foam.css">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="../../lib/mdui/style.css">
  <script language="javascript" src="../../core/bootFOAM.js"></script>
  <script language="javascript" src="../../core/SyncManager.js"></script>
  <script language="javascript" src="../../lib/bookmarks/bookmark.js"></script>
  <script language="javascript" src="../../lib/mdui/AppController.js"></script>
  <script language="javascript" src="../../lib/mdui/view.js"></script>
  <script src="../../lib/gmail/ImportedModels.js"></script>
  <script src="../../lib/gmail/dao.js"></script>
  <script src="../../lib/gmail/SyncAgent.js"></script>
  <script src="../mailreader/email.js"></script>
  <script language="javascript" src="gmail.js"></script>
 </head>
 <body>
  <script>
    var randomBoolean = function() {
      return Math.random() < 0.5;
    };
    var randomCharacter = function() {
      var chars = "0123456789abcdefghijklmnopqurstuvwxyzABCDEFGHIJKLMNOPQURSTUVWXYZ";
      return chars.charAt(Math.floor(Math.random() * chars.length));
    };
    var randomString = function(length) {
      var s = '';
      for (var i = 0; i < length; i++) {
        s = s + randomCharacter();
      }
      return s;
    };
    var randomStringWithRandomLength = function(maxLength) {
      return randomString(Math.random() * maxLength);
    };
    var randomEmail = function() {
      return randomStringWithRandomLength(20) + ' ' + randomStringWithRandomLength(20) + ' <' + randomStringWithRandomLength(20) + '@' + randomStringWithRandomLength(20) + '.com>';
    };

    var emailDao = MDAO.create({model: EMail});
    for (var i = 0; i < 1000; i++) {
      var email = EMail.create({
        id: randomString(16),
        convId: randomString(16),
        timestamp: new Date().getTime() - Math.random() * 1000000000,
        from: randomEmail(),
        to: randomEmail(),
        replyTo: randomEmail(),
        subject: randomStringWithRandomLength(50),
        labels: [],
        body: randomStringWithRandomLength(1000),
      });
      randomBoolean() && email.labels.push('INBOX');
      randomBoolean() && email.labels.push('UNREAD');
      randomBoolean() && email.labels.push('STARRED');
      randomBoolean() && email.labels.push('CATEGORY_PERSONAL');
      randomBoolean() && email.labels.push('CATEGORY_FORUMS');
      randomBoolean() && email.labels.push('CATEGORY_SOCIAL');
      emailDao.put(email);
    }

    var gmailSyncManager = createGmailSyncAgent();
    // TODO: In the EMailCitationView it refers to mgmail. It should use context but that's not working.
    var mgmail = MGmail.create({
      gmailSyncManager: gmailSyncManager,
      emailDao: emailDao,
    });
    mgmail.write(document);
  </script>
 </body>
</html>
